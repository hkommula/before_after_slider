<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Before / After Viewer</title>

<style>
    * { box-sizing: border-box; }

    body {
        margin: 0;
        font-family: system-ui, sans-serif;
        background: linear-gradient(135deg, #f8f1f6, #e9eff8); /* lighter pinkish-blueish */
        color: #111;
        overflow: hidden; /* Hide page during loader */
    }

    /* =========================================================
       LOADING SCREEN
    ==========================================================*/

    #loaderScreen {
        position: fixed;
        inset: 0;
        background: #f3f4f6;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        z-index: 9999;
        font-family: system-ui, sans-serif;
    }

    .spinner {
        width: 48px;
        height: 48px;
        border: 6px solid #d1d5db;
        border-top-color: #3b82f6;
        border-radius: 50%;
        animation: spin 0.9s linear infinite;
        margin-bottom: 18px;
    }

    @keyframes spin {
        to { transform: rotate(360deg); }
    }

    .loadingText {
        font-size: 1rem;
        color: #374151;
        text-align: center;
        min-height: 30px;
        white-space: nowrap;
        border-right: 2px solid #9ca3af;
        animation: caretBlink 0.8s infinite;
    }

    @keyframes caretBlink {
        0%, 100% { border-right-color: transparent; }
        50% { border-right-color: #9ca3af; }
    }

    /* =========================================================
       MAIN UI LAYOUT
    ==========================================================*/

    #app {
        opacity: 0;
        transition: opacity 0.6s ease-out;
        padding: 24px;
        overflow: auto;
        height: 100vh;
        justify-content: center;
        align-items: center;
        display: flex;
    }

    .frame {
        width: min(80vw, 1100px);
        margin: auto;
        padding: 20px;
        background: #ffffff;
        border-radius: 18px;
        box-shadow: 0 16px 40px rgba(0,0,0,0.08);
        display: flex;
        flex-direction: column;
        gap: 18px;
    }

    .frame-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .frame-title {
        font-size: 1.1rem;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        font-weight: 600;
    }

    .frame-meta {
        font-size: 0.85rem;
        color: #6b7280;
    }

    .frame-body {
        display: flex;
        gap: 16px;
    }

    /* =========================================================
       THUMBNAILS
    ==========================================================*/

    .thumbs-column {
        width: 90px;
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    .thumb-btn {
        border: none;
        background: none;
        border-radius: 10px;
        overflow: hidden;
        cursor: pointer;
        box-shadow: 0 4px 12px rgba(0,0,0,0.18);
        transition: transform 0.15s;
    }

    .thumb-btn img {
        width: 100%;
        height: 60px;
        object-fit: cover;
        filter: brightness(0.85);
    }

    .thumb-btn:hover img {
        filter: brightness(1);
        transform: scale(1.04);
    }

    .thumb-btn-active {
        outline: 2px solid #3b82f6;
        transform: translateY(-2px);
    }

    .thumbs-column {
        width: 90px;
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    .thumb-btn {
        position: relative;              /* NEW: so the label can overlay */
        border: none;
        background: none;
        border-radius: 10px;
        overflow: hidden;
        cursor: pointer;
        box-shadow: 0 4px 12px rgba(0,0,0,0.18);
        transition: transform 0.15s;
    }

    .thumb-btn img {
        width: 100%;
        height: 60px;
        object-fit: cover;
        filter: brightness(0.85);
    }

    /* NEW: small "Set X" label on each thumbnail */
    .thumb-label {
        position: absolute;
        left: 50%;
        bottom: 4px;
        transform: translateX(-50%);
        padding: 1px 6px;
        border-radius: 999px;
        font-size: 0.7rem;
        letter-spacing: 0.4px;
        font-weight: 600;
        font-family: "Inter", "Roboto Condensed", "Helvetica Neue", sans-serif;
        background: rgba(0, 0, 0, 0.15); /* dark, semi-transparent */
        color: #f9fafb;
        pointer-events: none;
        backdrop-filter: blur(2px);
    }

    .thumb-btn:hover img {
        filter: brightness(1);
        transform: scale(1.04);
    }


    /* =========================================================
       COMPARISON SLIDER
    ==========================================================*/

    .comparison-shell {
        flex: 1;
        border-radius: 14px;
        overflow: hidden;
        background: #000;
        position: relative;
    }

    .comparison-slider {
        --percent: 50;
        --alpha: 0.5;
        --zoom: 1;
        --offsetX: 0px;
        --offsetY: 0px;

        width: 100%;
        height: 100%;
        position: relative;
        user-select: none;
        overflow: hidden;
    }

    .comparison-inner {
        width: 100%;
        height: 100%;
        transform: translate(var(--offsetX), var(--offsetY)) scale(var(--zoom));
        transform-origin: center;
        transition: transform 0.15s ease-out;
    }

    .comparison-after {
        width: 100%;
        display: block;
        pointer-events: none;
    }

    .comparison-before-wrapper {
        position: absolute;
        inset: 0;
        pointer-events: none;
    }

    .comparison-before {
        width: 100%;
        height: 100%;
        object-fit: cover;
        opacity: var(--alpha);
    }

    /* Handle */
    .comparison-handle {
        position: absolute;
        top: 0;
        bottom: 0;
        left: calc(var(--percent) * 1%);
        transform: translateX(-50%);
        pointer-events: none;
    }

    .comparison-handle-line {
        width: 2px;
        background: #fff;
        height: 100%;
        box-shadow: 0 0 12px rgba(0,0,0,0.4);
    }

    .comparison-handle-knob {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: #fff;
        box-shadow: 0 0 0 1px #aaa, 0 8px 16px rgba(0,0,0,0.25);
    }

    /* Labels */
    .comparison-label {
        position: absolute;
        top: 8px;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 0.75rem;
        font-weight: 600;
        backdrop-filter: blur(6px);
        z-index: 3;
        overflow: hidden;              /* so the fill stays inside the pill */
    }

    /* text sits above fill */
    .comparison-label .label-text {
        position: relative;
        z-index: 2;
    }

    /* generic fill background */
    .comparison-label::before {
        content: "";
        position: absolute;
        top: 0;
        bottom: 0;
        z-index: 1;
        pointer-events: none;
    }

    /* After label â€“ stays in place, fills from the left */
    .comparison-label-after {
        left: 8px;
        background: #dbeafe;
        color: #1e3a8a;
    }

    .comparison-label-after::before {
        left: 0;
        width: var(--afterFill, 50%);
        background: rgba(37, 99, 235, 0.10); /* darker blue fill */
    }

    /* Before label â€“ stays in place, fills from the right */
    .comparison-label-before {
        right: 8px;
        background: #fee2e2;
        color: #7f1d1d;
    }

    .comparison-label-before::before {
        right: 0;
        width: var(--beforeFill, 50%);
        background: rgba(220, 38, 38, 0.10); /* darker red fill */
    }

</style>
</head>

<body>

<!-- =========================================================
     LOADER SCREEN
========================================================== -->
<div id="loaderScreen">
    <div class="spinner"></div>
    <div class="loadingText" id="loadingText"></div>
</div>

<!-- =========================================================
     MAIN APP
========================================================== -->
<div id="app">
    <div class="frame">

        <div class="frame-header">
            <div>
                <div class="frame-title">Before / After Viewer</div>
                <div class="frame-meta">
                    Left-drag to reveal â€¢ Scroll to zoom â€¢ Ctrl + Left-drag to pan
                </div>
            </div>

            <select id="imageSetSelect" class="set-select">
                <option value="0">Set 1</option>
                <option value="1">Set 2</option>
            </select>
        </div>

        <div class="frame-body">

            <!-- Thumbnails -->
            <div class="thumbs-column" id="thumbList"></div>

            <!-- Comparison viewer -->
            <div class="comparison-shell">
                <div class="comparison-slider" id="comparisonSlider">

                    <div class="comparison-inner" id="comparisonInner">
                        <img src="after.jpg" id="imgAfter" class="comparison-after" draggable="false">
                        <div class="comparison-before-wrapper">
                            <img src="before.jpg" id="imgBefore" class="comparison-before" draggable="false">
                        </div>
                    </div>

                    <div class="comparison-label comparison-label-after">
                        <span class="label-text">
                            After <span style="opacity:0.65; font-size:0.75em;">(Top Image)</span>
                        </span>
                    </div>

                    <div class="comparison-label comparison-label-before">
                        <span class="label-text">
                            Before <span style="opacity:0.65; font-size:0.75em;">(Bottom Image)</span>
                        </span>
                    </div>

                    <div class="comparison-handle">
                        <div class="comparison-handle-line"></div>
                        <div class="comparison-handle-knob"></div>
                    </div>
                </div>
            </div>

        </div>

    </div>
</div>

<script>
/* =========================================================
   LOADER FUNNY RANDOM TYPING MESSAGES
========================================================= */

const funnyMessages = [
    "Calibrating pixelsâ€¦ please stand still ðŸ‘€",
    "Teaching the images to behaveâ€¦",
    "Sharpening contrast with a tiny sword ðŸ—¡ï¸",
    "Loadingâ€¦ teleportation still in beta",
    "Polishing the visuals until they shine âœ¨",
    "Convincing the images not to fightâ€¦",
    "Aligning photons in your honor ðŸš€",
];

const loadingText = document.getElementById("loadingText");

function typeMessage(text, callback) {
    let i = 0;
    loadingText.textContent = "";
    const intv = setInterval(() => {
        loadingText.textContent += text[i];
        i++;
        if (i >= text.length) {
            clearInterval(intv);
            setTimeout(callback, 700);
        }
    }, 80);
}

function cycleMessages() {
    const randomMsg = funnyMessages[Math.floor(Math.random() * funnyMessages.length)];
    typeMessage(randomMsg, cycleMessages);
}

cycleMessages();

/* Simulate loading */
window.addEventListener("load", () => {
    setTimeout(() => {
        document.body.style.overflow = "auto";
        document.getElementById("loaderScreen").style.display = "none";
        document.getElementById("app").style.opacity = 1;
    }, 1500);
});


/* =========================================================
   IMAGE VIEWER LOGIC (NOW DRIVEN BY sets.json)
========================================================= */

let imageSets = []; // will be loaded from images/sets.json

const slider    = document.getElementById("comparisonSlider");
const inner     = document.getElementById("comparisonInner");
const beforeImg = document.getElementById("imgBefore");
const afterImg  = document.getElementById("imgAfter");
const thumbList = document.getElementById("thumbList");
const setSelect = document.getElementById("imageSetSelect");

let zoom = 1;
let offsetX = 0;
let offsetY = 0;
let revealPercent = 50;

/* ======== Reveal / blend logic ======== */

function applyReveal() {
    revealPercent = Math.max(0, Math.min(100, revealPercent));

    const alpha = 1 - revealPercent / 100;

    slider.style.setProperty("--percent", revealPercent);
    slider.style.setProperty("--alpha", alpha);

    const afterFraction = revealPercent / 100;
    const beforeFraction = alpha;

    slider.style.setProperty("--afterFill", (afterFraction * 100) + "%");
    slider.style.setProperty("--beforeFill", (beforeFraction * 100) + "%");
}

function clientXToPercent(x) {
    const rect = slider.getBoundingClientRect();
    return Math.min(100, Math.max(0, ((x - rect.left) / rect.width) * 100));
}

/* ======== Zoom / Pan logic ======== */

function clampPan() {
    const rect = slider.getBoundingClientRect();
    const w = rect.width;
    const h = rect.height;

    const zoomedW = w * zoom;
    const zoomedH = h * zoom;

    const overflowX = (zoomedW - w) / 2;
    const overflowY = (zoomedH - h) / 2;

    offsetX = Math.max(-overflowX, Math.min(overflowX, offsetX));
    offsetY = Math.max(-overflowY, Math.min(overflowY, offsetY));
}

function applyZoomPan() {
    clampPan();
    slider.style.setProperty("--zoom", zoom);
    slider.style.setProperty("--offsetX", offsetX + "px");
    slider.style.setProperty("--offsetY", offsetY + "px");
}

/* ======== Pointer controls ======== */

let draggingReveal = false;
let panning = false;
let panStartX = 0, panStartY = 0;
let panBaseX = 0, panBaseY = 0;

slider.addEventListener("pointerdown", (e) => {
    if (e.button !== 0) return;

    if (e.ctrlKey) {
        panning = true;
        panStartX = e.clientX;
        panStartY = e.clientY;
        panBaseX = offsetX;
        panBaseY = offsetY;
    } else {
        draggingReveal = true;
        revealPercent = clientXToPercent(e.clientX);
        applyReveal();
    }

    slider.setPointerCapture(e.pointerId);
});

slider.addEventListener("pointermove", (e) => {
    if (draggingReveal && (e.buttons & 1)) {
        revealPercent = clientXToPercent(e.clientX);
        applyReveal();
    }

    if (panning && (e.buttons & 1)) {
        offsetX = panBaseX + (e.clientX - panStartX);
        offsetY = panBaseY + (e.clientY - panStartY);
        applyZoomPan();
    }
});

slider.addEventListener("pointerup", () => {
    draggingReveal = false;
    panning = false;
});

slider.addEventListener("pointerleave", () => {
    draggingReveal = false;
    panning = false;
});

/* ======== Scroll to zoom ======== */

slider.addEventListener("wheel", (e) => {
    e.preventDefault();
    zoom -= e.deltaY * 0.0015;
    zoom = Math.max(1, Math.min(3, zoom));
    applyZoomPan();
}, { passive: false });

/* =========================================================
   Dynamic thumbnail + select building from imageSets
========================================================= */

function buildThumbnails() {
    thumbList.innerHTML = "";
    imageSets.forEach((set, i) => {
        const b = document.createElement("button");
        b.className = "thumb-btn";
        b.innerHTML = `
            <img src="${set.after}" alt="Thumbnail for set ${set.id || (i + 1)}">
            <span class="thumb-label">${set.id || ("Set " + (i + 1))}</span>
        `;
        b.addEventListener("click", () => loadSet(i));
        thumbList.appendChild(b);
    });
}

function buildSelect() {
    setSelect.innerHTML = "";
    imageSets.forEach((set, i) => {
        const opt = document.createElement("option");
        opt.value = String(i);
        opt.textContent = set.id ? set.id : `Set ${i + 1}`;
        setSelect.appendChild(opt);
    });
}

function markActive(index) {
    [...thumbList.children].forEach((b, i) => {
        b.classList.toggle("thumb-btn-active", i === index);
    });
}

function loadSet(index) {
    const set = imageSets[index];
    if (!set) return;

    beforeImg.src = set.before;
    afterImg.src  = set.after;

    zoom = 1;
    offsetX = 0;
    offsetY = 0;
    revealPercent = 50;

    applyReveal();
    applyZoomPan();
    markActive(index);
    setSelect.value = String(index);
}

setSelect.addEventListener("change", (e) => {
    const idx = Number(e.target.value);
    loadSet(idx);
});

/* =========================================================
   Fetch sets.json and initialise viewer
========================================================= */

async function loadImageSets() {
    try {
        // cache-bust in case GitHub Pages aggressively caches
        const response = await fetch("images/sets.json?cacheBust=" + Date.now());
        if (!response.ok) {
            console.error("Failed to load sets.json", response.status);
            return;
        }

        const data = await response.json();
        if (!data || !Array.isArray(data.sets)) {
            console.error("sets.json has unexpected structure");
            return;
        }

        imageSets = data.sets;
        if (!imageSets.length) {
            console.warn("No image sets found in sets.json");
            return;
        }

        buildThumbnails();
        buildSelect();
        loadSet(0);  // start with the first set
    } catch (err) {
        console.error("Error loading sets.json", err);
    }
}

// Start loading image sets once the DOM is ready
document.addEventListener("DOMContentLoaded", loadImageSets);
</script>


</body>
</html>
